function mixin(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i}function lerp(e,t,i){return e+i*(t-e)}function prettyTime(e){e=e||0;var t=e%60|0,i=e/60%60|0,n=e/3600|0;return n?n+":"+("0"+i).substr(-2)+":"+("0"+t).substr(-2):i+":"+("0"+t).substr(-2)}function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function clamp(e,t,i){return Math.max(Math.min(e,i),t)}function Sprite(e){e=e||{},this.img=e.img?e.img:null,this.sizeX=isNullOrUndef(e.sizeX)?isNullOrUndef(e.size)?1:e.size:e.sizeX,this.sizeY=isNullOrUndef(e.sizeY)?isNullOrUndef(e.size)?1:e.size:e.sizeY}function GameObject(e){e=e||{};var t=null;Object.defineProperty(this,"parent",{get:function(){return t},set:function(e){return t!==e&&(null!==t&&t.children.splice(t.children.indexOf(this),1),t=e,t&&t.children.push(this)),e}}),this.addChildren=function(){for(var e=0;e<arguments.length;e++)arguments[e].parent=this},Object.defineProperty(this,"addChildren",{enumerable:!1}),this.visible=!!isNullOrUndef(e.visible)||e.visible,this.opacity=isNullOrUndef(e.opacity)?1:e.opacity,this.children=[],this.position=new NATH.Vec2(e.position),this.orientation=e.orientation||0,this.sprite=e.sprite||null,this.shape=e.shape||null}function Vehicle(e){e=e||{},GameObject.call(this,e),this.frtWheelDst=isNullOrUndef(e.frtWheelDst)?3.6:e.frtWheelDst,this.bckWheelDst=isNullOrUndef(e.bckWheelDst)?3.6:e.bckWheelDst,this.length=isNullOrUndef(e.length)?12:e.length,this.width=isNullOrUndef(e.width)?2.5:e.width,this.wheelConeAngle=isNullOrUndef(e.wheelConeAngle)?75:e.wheelConeAngle,this.wheelOrientSpeed=isNullOrUndef(e.wheelOrientSpeed)?.1:e.wheelOrientSpeed,this.wheelOrientation=isNullOrUndef(e.wheelOrientation)?0:e.wheelOrientation,this.engineForce=isNullOrUndef(e.engineForce)?0:e.engineForce,this.enginePing=isNullOrUndef(e.enginePing)?.9:e.enginePing,this.enginePower=isNullOrUndef(e.enginePower)?1:e.enginePower,this.shape=new NATH.Rect2(this.length,this.width);var t=new NATH.Rect2(.9,.4);this.leftBackWheelObj=new GameObject({shape:t,position:[-this.frtWheelDst,this.width/2]}),this.leftFrontWheelObj=new GameObject({shape:t,position:[this.bckWheelDst,this.width/2]}),this.rightBackWheelObj=new GameObject({shape:t,position:[-this.frtWheelDst,-this.width/2]}),this.rightFrontWheelObj=new GameObject({shape:t,position:[this.bckWheelDst,-this.width/2]}),this.addChildren(this.leftBackWheelObj,this.rightBackWheelObj,this.leftFrontWheelObj,this.rightFrontWheelObj)}var TLS={loadFile:function(e,t,i,n){n=n||this;var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=t,o.onload=function(){if(200!==o.status)throw new Error("XMLHttpRequest to "+e+" failed: "+o.status+" "+o.statusText);i.call(n,o.response)},o.onprogress=function(t){console.log("Loading "+e+": "+Math.floor(t.loaded/t.total*100)+"%")},o.send()},loadFiles:function(e,t,i,n){n=n||this;var o=0,r=[];if("string"==typeof t){var s=t;t=Array(e.length);for(var h=0;h<t.length;h++)t[h]=s}e.forEach(function(e,s,h){TLS.loadFile(e,t[s],function(e){o++,r[s]=e,o===h.length&&i.call(n,r)})})},keyCodes:{zero:48,one:49,two:50,three:51,four:52,five:53,six:54,seven:55,eight:56,nine:57,break:3,backspace:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,spacebar:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,print:42,execute:43,printScreen:44,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,numpadZero:96,numpadOne:97,numpadTwo:98,numpadThree:99,numpadFour:100,numpadFive:101,numpadSix:102,numpadSeven:103,numpadEight:104,numpadNine:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222,altgr:225,toggleTouchpad:255},isKeyDown:function(){var e=[];return window.addEventListener("keydown",function(t){t.preventDefault(),e[t.keyCode]=!0}),window.addEventListener("keyup",function(t){t.preventDefault(),e[t.keyCode]=!1}),function(t){return!!e[t]}}()};Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var i=this[e],n=i,o=function(){return n},r=function(o){return i=n,n=t.call(this,e,i,o)};delete this[e]&&Object.defineProperty(this,e,{get:o,set:r,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),CanvasRenderingContext2D.prototype.roundRect=function(e,t,i,n,o){return o=Math.max(o,0),0===o?(this.beginPath(),void this.rect(e,t,i,n)):(i<2*o&&(o=i/2),n<2*o&&(o=n/2),this.beginPath(),this.moveTo(e+o,t),this.arcTo(e+i,t,e+i,t+n,o),this.arcTo(e+i,t+n,e,t+n,o),this.arcTo(e,t+n,e,t,o),this.arcTo(e,t,e+i,t,o),void this.closePath())},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON,Vehicle.prototype=mixin(GameObject.prototype,{actionOrientWheels:function(e,t){this.wheelOrientation+=this.wheelOrientSpeed*(e>0?1:-1)*t,this.wheelOrientation=clamp(this.wheelOrientation,-this.wheelConeAngle/2,this.wheelConeAngle/2),this.leftFrontWheelObj.orientation=this.rightFrontWheelObj.orientation=this.wheelOrientation},actionGaz:function(e,t){this.engineForce=lerp(e*this.enginePower*t,this.engineForce,this.enginePing)},applyForces:function(){var e=new NATH.Vec2,t=new NATH.Vec2,i=new NATH.Vec2,n=new NATH.Vec2;return function(o){this.getDirection(i),this.engineForce=lerp(this.engineForce,0,.1),n.set(i).mul(this.engineForce*(o/1e3)),e.set(this.position).sub(i.x*this.bckWheelDst,i.y*this.bckWheelDst),t.set(this.position).add(i.x*this.frtWheelDst,i.y*this.frtWheelDst),e.add(n),t.add(n.rotateDeg(this.wheelOrientation)),this.orientation=NATH.toDegrees(e.vectorTo(t).angle()),this.position.set(e.add(t).div(2))}}(),getDirection:function(e){return e=e||new NATH.Vec2,e.set(Math.cos(NATH.toRadians(this.orientation)),Math.sin(NATH.toRadians(this.orientation)))}}),Vehicle.prototype.constructor=Vehicle;var AudioContext=window.AudioContext||window.webkitAudioContext;window.addEventListener("load",function(){function e(){a=Date.now(),s=a-h,n.width==n.clientWidth&&n.height==n.clientHeight||(n.width=n.clientWidth,n.height=n.clientHeight,aspect=n.width/n.height,l=Math.min(n.width,n.height),c=n.width/l,d=n.height/l),TLS.isKeyDown(TLS.keyCodes.up)&&p.actionGaz(1,s),TLS.isKeyDown(TLS.keyCodes.down)&&p.actionGaz(-1,s),TLS.isKeyDown(TLS.keyCodes.left)&&p.actionOrientWheels(1,s),TLS.isKeyDown(TLS.keyCodes.right)&&p.actionOrientWheels(-1,s),p.applyForces(s),w(),h=a,i(e)}function t(){if(!n||!o||!r)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");n.width=document.body.clientWidth,n.height=document.body.clientHeight,aspect=n.width/n.height,l=Math.min(n.width,n.height),c=n.width/l,d=n.height/l,f.addChildren(p),e()}var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},n=document.getElementById("cvs"),o=n.getContext("2d"),r=new AudioContext,s=0,h=Date.now(),a=Date.now(),l=0,c=0,d=0,u=.01,f=new GameObject,p=new Vehicle,w=function(){function e(t){if(t.visible){if(o.save(),o.translate(t.position.x,t.position.y),o.rotate(NATH.toRadians(t.orientation)),o.globalAlpha=t.opacity,o.fillStyle="white",t.sprite)t.sprite.img&&o.drawImage(img,-t.sprite.sizeX/2,-t.sprite.sizeY/2,t.sprite.sizeX,t.sprite.sizeY);else if(t.shape&&t.shape.vertices.length>=6){o.beginPath(),o.moveTo(t.shape.vertices[0],t.shape.vertices[1]);for(var i=2;i<t.shape.vertices.length;i+=2)o.lineTo(t.shape.vertices[i],t.shape.vertices[i+1]);o.fill()}for(var i=0;i<t.children.length;i++)t.children[i].visible&&e(t.children[i]);o.restore()}}return function(){o.clearRect(0,0,n.width,n.height),o.save(),o.translate(n.width/2,n.height/2),o.scale(l,-l),o.scale(u,u),e(f),o.restore()}}();t()});